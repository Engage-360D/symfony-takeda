<?php

namespace Engage360d\Bundle\TakedaTestBundle\Processing;

use Engage360d\Bundle\TakedaTestBundle\Entity\TestResult;
use Engage360d\Bundle\TakedaTestBundle\Helpers;

class ScoreCalculator
{
    private static $scoreMatrix = array(
        "female" => array(
            65 => array(
                0 => array(
                    180 => array(
                        4 => 6,
                        5 => 6,
                        6 => 7,
                        7 => 8,
                        8 => 10,
                    ),
                    160 => array(
                        4 => 4,
                        5 => 4,
                        6 => 5,
                        7 => 6,
                        8 => 7,
                    ),
                    140 => array(
                        4 => 2,
                        5 => 3,
                        6 => 3,
                        7 => 4,
                        8 => 5,
                    ),
                    120 => array(
                        4 => 2,
                        5 => 2,
                        6 => 2,
                        7 => 3,
                        8 => 3,
                    ),
                ),
                1 => array(
                    180 => array(
                        4 => 12,
                        5 => 14,
                        6 => 15,
                        7 => 17,
                        8 => 20,
                    ),
                    160 => array(
                        4 => 8,
                        5 => 9,
                        6 => 10,
                        7 => 12,
                        8 => 14,
                    ),
                    140 => array(
                        4 => 5,
                        5 => 6,
                        6 => 7,
                        7 => 8,
                        8 => 10,
                    ),
                    120 => array(
                        4 => 4,
                        5 => 4,
                        6 => 5,
                        7 => 6,
                        8 => 7,
                    ),
                ),
            ),
            60 => array(
                0 => array(
                    180 => array(
                        4 => 3,
                        5 => 4,
                        6 => 4,
                        7 => 5,
                        8 => 6,
                    ),
                    160 => array(
                        4 => 2,
                        5 => 2,
                        6 => 2,
                        7 => 2,
                        8 => 4,
                    ),
                    140 => array(
                        4 => 1,
                        5 => 2,
                        6 => 2,
                        7 => 2,
                        8 => 3,
                    ),
                    120 => array(
                        4 => 1,
                        5 => 1,
                        6 => 1,
                        7 => 2,
                        8 => 2,
                    ),
                ),
                1 => array(
                    180 => array(
                        4 => 7,
                        5 => 8,
                        6 => 9,
                        7 => 11,
                        8 => 12,
                    ),
                    160 => array(
                        4 => 5,
                        5 => 5,
                        6 => 6,
                        7 => 7,
                        8 => 8,
                    ),
                    140 => array(
                        4 => 3,
                        5 => 4,
                        6 => 4,
                        7 => 5,
                        8 => 6,
                    ),
                    120 => array(
                        4 => 2,
                        5 => 2,
                        6 => 3,
                        7 => 3,
                        8 => 4,
                    ),
                ),
            ),
            55 => array(
                0 => array(
                    180 => array(
                        4 => 2,
                        5 => 2,
                        6 => 2,
                        7 => 3,
                        8 => 3,
                    ),
                    160 => array(
                        4 => 1,
                        5 => 1,
                        6 => 2,
                        7 => 2,
                        8 => 2,
                    ),
                    140 => array(
                        4 => 1,
                        5 => 1,
                        6 => 1,
                        7 => 1,
                        8 => 1,
                    ),
                    120 => array(
                        4 => 0,
                        5 => 1,
                        6 => 1,
                        7 => 1,
                        8 => 1,
                    ),
                ),
                1 => array(
                    180 => array(
                        4 => 4,
                        5 => 4,
                        6 => 5,
                        7 => 6,
                        8 => 7,
                    ),
                    160 => array(
                        4 => 3,
                        5 => 3,
                        6 => 3,
                        7 => 4,
                        8 => 5,
                    ),
                    140 => array(
                        4 => 2,
                        5 => 2,
                        6 => 2,
                        7 => 3,
                        8 => 3,
                    ),
                    120 => array(
                        4 => 1,
                        5 => 1,
                        6 => 2,
                        7 => 2,
                        8 => 2,
                    ),
                ),
            ),
            50 => array(
                0 => array(
                    180 => array(
                        4 => 1,
                        5 => 1,
                        6 => 1,
                        7 => 1,
                        8 => 2,
                    ),
                    160 => array(
                        4 => 1,
                        5 => 1,
                        6 => 1,
                        7 => 1,
                        8 => 1,
                    ),
                    140 => array(
                        4 => 0,
                        5 => 0,
                        6 => 1,
                        7 => 1,
                        8 => 1,
                    ),
                    120 => array(
                        4 => 0,
                        5 => 0,
                        6 => 0,
                        7 => 0,
                        8 => 0,
                    ),
                ),
                1 => array(
                    180 => array(
                        4 => 2,
                        5 => 2,
                        6 => 3,
                        7 => 3,
                        8 => 4,
                    ),
                    160 => array(
                        4 => 1,
                        5 => 1,
                        6 => 2,
                        7 => 2,
                        8 => 2,
                    ),
                    140 => array(
                        4 => 1,
                        5 => 1,
                        6 => 1,
                        7 => 1,
                        8 => 2,
                    ),
                    120 => array(
                        4 => 1,
                        5 => 1,
                        6 => 1,
                        7 => 1,
                        8 => 1,
                    ),
                ),
            ),
            40 => array(
                0 => array(
                    180 => array(
                        4 => 0,
                        5 => 0,
                        6 => 0,
                        7 => 0,
                        8 => 0,
                    ),
                    160 => array(
                        4 => 0,
                        5 => 0,
                        6 => 0,
                        7 => 0,
                        8 => 0,
                    ),
                    140 => array(
                        4 => 0,
                        5 => 0,
                        6 => 0,
                        7 => 0,
                        8 => 0,
                    ),
                    120 => array(
                        4 => 0,
                        5 => 0,
                        6 => 0,
                        7 => 0,
                        8 => 0,
                    ),
                ),
                1 => array(
                    180 => array(
                        4 => 0,
                        5 => 0,
                        6 => 0,
                        7 => 1,
                        8 => 1,
                    ),
                    160 => array(
                        4 => 0,
                        5 => 0,
                        6 => 0,
                        7 => 0,
                        8 => 0,
                    ),
                    140 => array(
                        4 => 0,
                        5 => 0,
                        6 => 0,
                        7 => 0,
                        8 => 0,
                    ),
                    120 => array(
                        4 => 0,
                        5 => 0,
                        6 => 0,
                        7 => 0,
                        8 => 0,
                    ),
                ),
            ),
        ),
        "male" => array(
            65 => array(
                0 => array(
                    180 => array(
                        4 => 12,
                        5 => 14,
                        6 => 17,
                        7 => 20,
                        8 => 23,
                    ),
                    160 => array(
                        4 => 8,
                        5 => 10,
                        6 => 12,
                        7 => 14,
                        8 => 16,
                    ),
                    140 => array(
                        4 => 6,
                        5 => 7,
                        6 => 8,
                        7 => 10,
                        8 => 12,
                    ),
                    120 => array(
                        4 => 4,
                        5 => 5,
                        6 => 6,
                        7 => 7,
                        8 => 8,
                    ),
                ),
                1 => array(
                    180 => array(
                        4 => 24,
                        5 => 27,
                        6 => 31,
                        7 => 36,
                        8 => 47,
                    ),
                    160 => array(
                        4 => 17,
                        5 => 19,
                        6 => 23,
                        7 => 26,
                        8 => 31,
                    ),
                    140 => array(
                        4 => 11,
                        5 => 13,
                        6 => 16,
                        7 => 19,
                        8 => 23,
                    ),
                    120 => array(
                        4 => 8,
                        5 => 9,
                        6 => 11,
                        7 => 13,
                        8 => 16,
                    ),
                ),
            ),
            60 => array(
                0 => array(
                    180 => array(
                        4 => 8,
                        5 => 10,
                        6 => 12,
                        7 => 14,
                        8 => 16,
                    ),
                    160 => array(
                        4 => 6,
                        5 => 7,
                        6 => 8,
                        7 => 9,
                        8 => 11,
                    ),
                    140 => array(
                        4 => 4,
                        5 => 5,
                        6 => 5,
                        7 => 7,
                        8 => 8,
                    ),
                    120 => array(
                        4 => 3,
                        5 => 3,
                        6 => 4,
                        7 => 5,
                        8 => 6,
                    ),
                ),
                1 => array(
                    180 => array(
                        4 => 17,
                        5 => 19,
                        6 => 22,
                        7 => 26,
                        8 => 31,
                    ),
                    160 => array(
                        4 => 11,
                        5 => 13,
                        6 => 16,
                        7 => 19,
                        8 => 22,
                    ),
                    140 => array(
                        4 => 8,
                        5 => 9,
                        6 => 11,
                        7 => 13,
                        8 => 16,
                    ),
                    120 => array(
                        4 => 5,
                        5 => 6,
                        6 => 8,
                        7 => 9,
                        8 => 11,
                    ),
                ),
            ),
            55 => array(
                0 => array(
                    180 => array(
                        4 => 5,
                        5 => 6,
                        6 => 8,
                        7 => 9,
                        8 => 11,
                    ),
                    160 => array(
                        4 => 4,
                        5 => 4,
                        6 => 5,
                        7 => 6,
                        8 => 8,
                    ),
                    140 => array(
                        4 => 2,
                        5 => 3,
                        6 => 4,
                        7 => 4,
                        8 => 5,
                    ),
                    120 => array(
                        4 => 2,
                        5 => 2,
                        6 => 2,
                        7 => 3,
                        8 => 4,
                    ),
                ),
                1 => array(
                    180 => array(
                        4 => 11,
                        5 => 13,
                        6 => 15,
                        7 => 18,
                        8 => 21,
                    ),
                    160 => array(
                        4 => 7,
                        5 => 9,
                        6 => 10,
                        7 => 13,
                        8 => 15,
                    ),
                    140 => array(
                        4 => 5,
                        5 => 6,
                        6 => 7,
                        7 => 9,
                        8 => 11,
                    ),
                    120 => array(
                        4 => 3,
                        5 => 4,
                        6 => 5,
                        7 => 6,
                        8 => 7,
                    ),
                ),
            ),
            50 => array(
                0 => array(
                    180 => array(
                        4 => 3,
                        5 => 4,
                        6 => 5,
                        7 => 6,
                        8 => 7,
                    ),
                    160 => array(
                        4 => 2,
                        5 => 3,
                        6 => 3,
                        7 => 4,
                        8 => 5,
                    ),
                    140 => array(
                        4 => 2,
                        5 => 2,
                        6 => 2,
                        7 => 3,
                        8 => 3,
                    ),
                    120 => array(
                        4 => 1,
                        5 => 1,
                        6 => 1,
                        7 => 2,
                        8 => 2,
                    ),
                ),
                1 => array(
                    180 => array(
                        4 => 7,
                        5 => 8,
                        6 => 9,
                        7 => 11,
                        8 => 14,
                    ),
                    160 => array(
                        4 => 5,
                        5 => 5,
                        6 => 7,
                        7 => 8,
                        8 => 10,
                    ),
                    140 => array(
                        4 => 3,
                        5 => 4,
                        6 => 4,
                        7 => 5,
                        8 => 7,
                    ),
                    120 => array(
                        4 => 2,
                        5 => 3,
                        6 => 3,
                        7 => 4,
                        8 => 5,
                    ),
                ),
            ),
            40 => array(
                0 => array(
                    180 => array(
                        4 => 1,
                        5 => 1,
                        6 => 1,
                        7 => 2,
                        8 => 2,
                    ),
                    160 => array(
                        4 => 1,
                        5 => 1,
                        6 => 1,
                        7 => 1,
                        8 => 1,
                    ),
                    140 => array(
                        4 => 0,
                        5 => 1,
                        6 => 1,
                        7 => 1,
                        8 => 1,
                    ),
                    120 => array(
                        4 => 0,
                        5 => 0,
                        6 => 0,
                        7 => 1,
                        8 => 1,
                    ),
                ),
                1 => array(
                    180 => array(
                        4 => 2,
                        5 => 2,
                        6 => 3,
                        7 => 3,
                        8 => 4,
                    ),
                    160 => array(
                        4 => 1,
                        5 => 2,
                        6 => 2,
                        7 => 2,
                        8 => 3,
                    ),
                    140 => array(
                        4 => 1,
                        5 => 1,
                        6 => 1,
                        7 => 2,
                        8 => 2,
                    ),
                    120 => array(
                        4 => 1,
                        5 => 1,
                        6 => 1,
                        7 => 1,
                        8 => 1,
                    ),
                ),
            ),
        ),
    );

    public function calculate(TestResult $testResult)
    {
        $sex = $testResult->getSex();
        $age = Helpers::roundToNearest($testResult->getBirthday()->diff(new \DateTime())->y, array(40, 50, 55, 60, 65));
        $isSmoker = (int)$testResult->getIsSmoker();
        $arterialPressure = Helpers::roundToNearest($testResult->getArterialPressure(), array(120, 140, 160, 180));
        $cholesterolLevel = Helpers::roundToNearest($testResult->getCholesterolLevel(), array(4, 5, 6, 7, 8));

        return self::$scoreMatrix[$sex][$age][$isSmoker][$arterialPressure][$cholesterolLevel];
    }
}
